
<!DOCTYPE html>
<html>
<head>
    <title>Diagnostic Acc√®s Propri√©taire</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .step { margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #007bff; border-radius: 5px; }
        .code { background: #e9ecef; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
        .button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        .success { border-left-color: #28a745; }
        .warning { border-left-color: #ffc107; }
        .error { border-left-color: #dc3545; }
        .info { border-left-color: #17a2b8; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagnostic Acc√®s Propri√©taire</h1>
        
        <div class="step info">
            <h3>√âtat actuel</h3>
            <div id="currentState">Chargement...</div>
        </div>
        
        <div class="step">
            <h3>Actions de diagnostic</h3>
            <button class="button" onclick="checkLocalStorage()">üîç V√©rifier localStorage</button>
            <button class="button" onclick="checkUserRole()">üë§ V√©rifier r√¥le utilisateur</button>
            <button class="button" onclick="checkCurrentUrl()">üìç V√©rifier URL actuelle</button>
            <button class="button" onclick="clearAllStorage()">üóëÔ∏è Nettoyer tout</button>
        </div>
        
        <div class="step success">
            <h3>Cr√©er utilisateur propri√©taire</h3>
            <button class="button" onclick="createOwnerUser()">üëë Cr√©er Propri√©taire</button>
            <button class="button" onclick="createOwnerAndRedirect()">üöÄ Cr√©er + Rediriger</button>
        </div>
        
        <div class="step warning">
            <h3>Test de redirection</h3>
            <button class="button" onclick="testRedirect('/teacher')">üìä Dashboard Enseignant</button>
            <button class="button" onclick="testRedirect('/student')">üéµ Dashboard √âl√®ve</button>
            <button class="button" onclick="testRedirect('/')">üè† Page d'accueil</button>
        </div>
        
        <div class="step">
            <h3>Logs de diagnostic</h3>
            <div id="logs" class="log"></div>
        </div>
        
        <div class="step error">
            <h3>Code de secours</h3>
            <p>Si rien ne fonctionne, copie ce code dans la console (F12) :</p>
            <div class="code">
// Nettoyer tout
localStorage.clear();

// Cr√©er propri√©taire
const ownerUser = {"id":"owner-permanent-123","firstName":"Propri√©taire","lastName":"Application","email":"proprietaire@musique.com","role":"owner","subscriptionStatus":"active","isActive":true,"createdAt":"2025-06-21T07:02:06.729Z","picture":null,"groups":[],"settings":{},"lastLogin":"2025-06-21T07:02:06.729Z"};
localStorage.setItem('tempOwner', JSON.stringify(ownerUser));

// Forcer le rechargement
window.location.href = 'http://localhost:5174/teacher';
            </div>
        </div>
    </div>
    
    <script>
        const ownerUser = {"id":"owner-permanent-123","firstName":"Propri√©taire","lastName":"Application","email":"proprietaire@musique.com","role":"owner","subscriptionStatus":"active","isActive":true,"createdAt":"2025-06-21T07:02:06.729Z","picture":null,"groups":[],"settings":{},"lastLogin":"2025-06-21T07:02:06.729Z"};
        
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += '[' + timestamp + '] ' + message + '\n';
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateCurrentState() {
            const state = document.getElementById('currentState');
            const currentUser = localStorage.getItem('tempOwner');
            const currentUrl = window.location.href;
            
            let stateText = '<strong>URL actuelle :</strong> ' + currentUrl + '<br>';
            stateText += '<strong>Utilisateur propri√©taire :</strong> ' + (currentUser ? '‚úÖ Pr√©sent' : '‚ùå Absent') + '<br>';
            
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    stateText += '<strong>R√¥le :</strong> ' + user.role + '<br>';
                    stateText += '<strong>Nom :</strong> ' + user.firstName + ' ' + user.lastName;
                } catch (e) {
                    stateText += '<strong>Erreur :</strong> Donn√©es corrompues';
                }
            }
            
            state.innerHTML = stateText;
        }
        
        function checkLocalStorage() {
            log('üîç V√©rification localStorage...');
            const keys = Object.keys(localStorage);
            log('Cl√©s trouv√©es : ' + keys.join(', '));
            
            keys.forEach(key => {
                if (key.startsWith('temp')) {
                    try {
                        const value = JSON.parse(localStorage.getItem(key));
                        log(key + ' : ' + JSON.stringify(value, null, 2));
                    } catch (e) {
                        log(key + ' : Donn√©es non-JSON');
                    }
                }
            });
        }
        
        function checkUserRole() {
            log('üë§ V√©rification r√¥le utilisateur...');
            const owner = localStorage.getItem('tempOwner');
            if (owner) {
                try {
                    const user = JSON.parse(owner);
                    log('R√¥le d√©tect√© : ' + user.role);
                    log('Utilisateur : ' + user.firstName + ' ' + user.lastName);
                } catch (e) {
                    log('Erreur parsing utilisateur : ' + e.message);
                }
            } else {
                log('Aucun utilisateur propri√©taire trouv√©');
            }
        }
        
        function checkCurrentUrl() {
            log('üìç URL actuelle : ' + window.location.href);
            log('Pathname : ' + window.location.pathname);
        }
        
        function clearAllStorage() {
            log('üóëÔ∏è Nettoyage localStorage...');
            localStorage.clear();
            log('localStorage vid√©');
            updateCurrentState();
        }
        
        function createOwnerUser() {
            log('üëë Cr√©ation utilisateur propri√©taire...');
            localStorage.setItem('tempOwner', JSON.stringify(ownerUser));
            log('Utilisateur propri√©taire cr√©√©');
            updateCurrentState();
        }
        
        function createOwnerAndRedirect() {
            log('üöÄ Cr√©ation + redirection...');
            localStorage.setItem('tempOwner', JSON.stringify(ownerUser));
            log('Redirection vers /teacher...');
            window.location.href = 'http://localhost:5174/teacher';
        }
        
        function testRedirect(path) {
            log('üß™ Test redirection vers ' + path);
            window.location.href = 'http://localhost:5174' + path;
        }
        
        // Initialisation
        updateCurrentState();
        log('Diagnostic d√©marr√©');
    </script>
</body>
</html>
